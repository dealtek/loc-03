<!DOCTYPE html>
<html>
<head>
<title>Geo App ADD Location</title>

<meta name="viewport" content="width=device-width, initial-scale=1"> 
<!-- -->
<link rel="stylesheet" href="inc/jq/themes/theme-02.min.css" />
<link rel="stylesheet" href="inc/jq/themes/jquery.mobile.icons.min.css" />

<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />


<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>




 <script>
	$(function(){
		$( "[data-role='header'], [data-role='footer']" ).toolbar();
		});
    </script>

<link href="mob.css" rel="stylesheet" type="text/css" />

<style type="text/css">

input999
{
	-moz-border-radius: 11px;
	border-radius: 11px;
	border: 1px solid #CCC;
	padding: .2em;
 	margin: .2em 0;
	
}

.label_16g999 {
	color: #999999;
	font-size: 16px;
}

.big24999 {
	font-family: Arial, Helvetica, sans-serif;
	color: #FFF;
	background-color: #6290ee;
	font-size: 24px;
}

.bigbutt999{ 

/*no need use one below - ui-radio input override*/
width: 6em; 
height: 6em; 
background-color: #6290ee;
}

.ui-radio input {
	position: absolute;
	left: .466em;
	top: 50%;
	width: 62px;
	height: 62px;
	margin: -11px 0 0 0;
	outline: 0 !important;
	z-index: 1;
	background-color: #0C0;
}





</style>
  
</head>
<body>

<script>
// no send until ready
// nah no var ---- var sendready = "no";
localStorage.setItem("sendready", 'no');
//alert (sendready);
</script>

<div data-role="header" data-position="fixed" data-theme="a">

<div class="box1 center1 boxblue" >
<a href="index.html" rel="external"><img src="app-logo-banner-320x60.png" width="320" height="61" class="center" ></a>
</div>
<!--<h1>Page head Title</h1> -->
</div><!-- /header -->

<section id="page1" data-role="page">

<div role="main" class="ui-content">
<div class="content" >
<div class="box1 center1" >
  
      
<!--INSERT START -->

<form action="" method="post" name="thisform" id="thisform" >


<table width="75%" border="0" align="center" cellpadding="4" cellspacing="4">
<tr>
<td colspan="2" align="center">
<span class="print_data_22">



Simple Geolocation Test <br><br>

cid <span id="nowcid"></span> - wid <span id="nowwid"></span><br>

<table width="98%" border="0" cellspacing="2" cellpadding="2">
<tr>
<td>
<a class="buttonlink7" href="index.html" rel="external"> <span class="bigfont2">HOME</span> </a></td>
<td><a class="buttonlink7" href="geo-list-mobile.html" rel="external"> <span class="bigfont2">Recent Activity</span> </a>
</td>
<td><a href="javascript:location.reload(true)" class="buttonlink7">Refresh Geo Location</a>
</td>
</tr>
</table>



<br>

<span class="print_data_22 fgreen" id="progress"></span>
</strong>
</span>
</td>
</tr>

<tr>
   
<td colspan="2"  align="center">
<span class="print_data_22 fgreen" >
<div id="show1">
<span id='responsepost'></span><br>
<!-- colors not working hmmm should be green -->
<input type="button" class="ui-btn ui-btn-d tsize1" name="submit" value= " - LOG THIS LOCATION - " onClick="testResults(this.form)" />
</div>
</span>


</td>
</tr>


<tr>
<td colspan="2"  align="center" valign="top"><p class="big24" id="actionchoice"></p></td>
</tr>


<tr>
<td width="50%"  align="left" valign="top">

Action:<br>
<script language="javascript">         
         function checkBtn(event) {
localStorage.setItem("action", event.target.name);
document.getElementById("actionchoice").innerHTML = event.target.name;



if (localStorage.getItem("sendready") == "yes"){

	$("#show1").show(1000);
	}

         }
      </script>

<input id="Arrive" type="button" class="buttonform2_24" name="Arrive" value= "Arrive" onClick="checkBtn(event)" />


<span id="action"></span></td>
<td width="50%" align="left" valign="top">
<br>

<input id="Leave" type="button" class="buttonform2_24" name="Leave" value= "Leave" onClick="checkBtn(event)" />

  </td>
</tr>

<tr>
<td colspan="2"  align="left" valign="top">
<span class="print_data_22">

Latitude: 
<span id="Latitude"></span></span>
</td>
</tr>
<tr>
<td colspan="2" align="left" valign="top">
<span class="print_data_22">
Longitude:
<span id="Longitude"></span></span></td>
</tr>
<tr>
<td colspan="2" align="left" valign="top">
<span class="print_data_22">
Accuracy:

<span id="Accuracy"></span></span></td>
</tr>
<tr>
<td colspan="2" align="left" valign="top">
<span class="print_data_22">
Timestamp:


<span id="Timestamp"></span></span></td>
</tr>
<tr>
<td colspan="2" align="left" valign="top">
<span class="print_data_22">
Timestamp as Date:<br>
<span id="nowgeots"></span>
</span>
</td>
</tr>
</table>

</form>

<script>

// onSuccess Callback
// This method accepts a Position object, which contains the
// current GPS coordinates
//

$("#show1").hide(1000);

document.getElementById('progress').textContent = "Looking up Your Current Location... ";

var onSuccess = function(position) {

// just local so goes away right after
// nah var sendready = "yes";
//alert(sendready);
    

// maybe dump these vars

var Latitude = position.coords.latitude;
var Longitude = position.coords.longitude;
var Altitude = position.coords.altitude;
var Accuracy = position.coords.accuracy;
var Altitude_Accuracy = position.coords.altitudeAccuracy;
var Heading = position.coords.heading;
var Speed = position.coords.speed;
var Timestamp = position.timestamp

var nowstamp = new Date();
var nowgeots = new Date(position.timestamp);



/*
// not now do later
function getFormattedDate(date) {
	var nowstamp = new Date(); // dupe
  var year = date.getFullYear();
  var month = (1 + date.getMonth()).toString();
  month = month.length > 1 ? month : '0' + month;
  var day = date.getDate().toString();
  day = day.length > 1 ? day : '0' + day;
  
  alert("aaa " + month + '/' + day + '/' + year);
  
  return month + '/' + day + '/' + year;
  
  
}
*/

document.getElementById('progress').textContent = "These are the results showing the current location... ";

// ok to send now
localStorage.setItem("sendready", 'yes');

document.getElementById('Latitude').textContent = Latitude;
document.getElementById('Longitude').textContent = Longitude;
//document.getElementById('Altitude').textContent = Altitude;
document.getElementById('Accuracy').textContent = Accuracy;
//document.getElementById('Altitude_Accuracy').textContent = Altitude_Accuracy;
//document.getElementById('Heading').textContent = Heading;
//document.getElementById('Speed').textContent = Speed;
document.getElementById('Timestamp').textContent = Timestamp;
document.getElementById('nowgeots').textContent = nowgeots;


// i guess var only good in block so move post here

// tmp use LS

localStorage.setItem("Latitude", position.coords.latitude);
localStorage.setItem("Longitude", position.coords.longitude);
localStorage.setItem("Accuracy", position.coords.accuracy);
localStorage.setItem("Timestamp", position.timestamp);
localStorage.setItem("nowgeots", new Date(position.timestamp));

// new tmp
localStorage.setItem("cid", 1);
localStorage.setItem("wid", 1);


};

// onError Callback receives a PositionError object
//
function onError(error) {
    alert('code: '    + error.code    + '\n' +
          'message: ' + error.message + '\n');
}

navigator.geolocation.getCurrentPosition(onSuccess, onError);
</script>
<script>
function testResults (form) {

// start post	
	
// show that something is loading
		$('#responsepost').html("<b>Loading response...</b>");
		
		/*
		 * 'post_receiver.php' - where you will pass the form data
		 * $(this).serialize() - to easily read form data
		 * function(data){... - data contains the response from post_receiver.php
		 */


//here new 

var getstuff = localStorage.getItem("Latitude") + " - " + localStorage.getItem("Longitude") + " - " + localStorage.getItem("Accuracy") + " - " + localStorage.getItem("Timestamp") + " - " + localStorage.getItem("nowgeots") + " - " + localStorage.getItem("action");

//alert("getstuff  " + getstuff);
	 
//$.post('https://idcapp.com/app-data/client-update-number.php', {
	
//$.post('../app-data/geo-add.php', {
	// no ssl here
$.post('http://nmiapp.com/zgeo/app-data/geo-add.php', {
//$.post('zgeox.html', {

latitude: 	localStorage.getItem("Latitude"),
longitude: 	localStorage.getItem("Longitude"),
accuracy: 	localStorage.getItem("Accuracy"),
timestamp: 	localStorage.getItem("Timestamp"),
nowgeots: 	localStorage.getItem("nowgeots"),
action: 	localStorage.getItem("action"),	
cid:		localStorage.getItem("nowcid"),	
wid:		localStorage.getItem("nowwid")

// there was cid and wid - maybe dump
	
}, function(data){
			
			// show the response
			$('#responsepost').html(data);
			//
			//alert( "Posting yo." + getstuff);
// no need
			
			//$('#response2').html(data);
		window.location.replace("geo-list-wrk-mobile.html");
		}).fail(function() {
		
			// just in case posting your form failed
			alert( "Posting failed." );
			
		});

		// to prevent refreshing the whole page page
		return false;


//window.location.replace("new-client-application-register3.html");
		
			
	
}
</script>




<script>

document.getElementById('nowcid').textContent = localStorage.getItem("nowcid");

document.getElementById('nowwid').textContent = localStorage.getItem("nowwid");



</script>



<script>

// start radio
// complex workaround just for radio buttons in safari

/*
REAL HERE

	window.onload=function() {
  var radios = document.getElementsByName('action');
  for (var i=0;i<radios.length;i++) {
    radios[i].onclick=function() {
		
	localStorage.setItem("action", this.value);
    //alert(this.value);
	
    }
  }

}

*/
	// end radio

</script>


<!--INSERT END -->

</div><!-- end .box -->
</div><!-- end .content -->
</div><!-- /ui-content -->
  
</section><!-- /page -->
<!--
<footer data-role="footer" class="ui-barNAH" data-position="fixed" data-theme="a">
<div class="ui-grid-c boxblue">
foot
</div>
</footer> -->

<!-- /footer -->

</body>
</html>
