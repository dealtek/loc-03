<!DOCTYPE html>
<html>
<head>
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="-1">

<title>Location App Title</title>

<meta name="viewport" content="width=device-width, initial-scale=1"> 


<link rel="stylesheet" href="inc/jq/themes/theme-02.min.css" />
<link rel="stylesheet" href="inc/jq/themes/jquery.mobile.icons.min.css" />

<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>






<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

<script>
	$(function(){
		$( "[data-role='header'], [data-role='footer']" ).toolbar();
		});
    </script>

<link href="mob.css" rel="stylesheet" type="text/css" />

<style type="text/css">
.thinbox {
	border: thin solid #CCC;
	/*margin: 4px;*/
	padding: 4px;
	/*width: 133px;*/
	}
</style> 


  
</head>
<body onload="initialize()">


<div data-role="header" data-position="fixed" data-theme="a">

<div class="box1 center1 boxblue" >
<a href="index.html" rel="external"><img src="app-logo-banner-320x60.png" width="300" height="60" border="0"></a>
</div>
<!--add header -->
</div>

<!-- /header -->

<section id="page01111" data-role="page">

<div role="main" class="ui-content">
<div class="content" >
<div class="box1 center1" >
  
      
<!--INSERT START -->


<table width="99%" border="0" cellspacing="2" cellpadding="2">
<tr>
<td><a rel="external" href="dr-dashboard.html" class="buttonlink2 center1">Driver Home</a></td>
<td><a rel="external" href="dr-geo-list-mobile.html" class="buttonlink2 center1">Recent Locations</a></td>
<td><a rel="external" href="dr-geo-add-button.html" class="buttonlink2 center1">Try Again</a></td>
</tr>
</table>











<br><br>



new<br>

yo<br>
<input id="Arrive44" type="button" class="buttonform2_24" name="Arrive" value= "Arrive33" onClick="getgeo(event)" />

<br><br>

<input id="Leave44" type="button" class="buttonform2_24" name="Leave" value= "Leave33" onClick="getgeo(event)" />

<br><br>

<!--  -->
<p class="big24" id="actionchoice"></p>

<br>

<span class="print_data_22 fgreen" id="progress"></span>
</strong>
</span>



<br>



part 2<br>



<div align="center" style="height: 1px; width: 320px">

<!--<input id="latlng" type="text" value="34.16214883658795,-118.40303643729916">


id="PUC_Number" name="PUC_Number"
<span id = "nowlat1"></span>,
<span id = "nowlng1"></span>
 
 -->
</div>
<!--
 -->
 
 
 <div id="mappy">
 <div id="map" style="height: 200px; width: 320px"></div>
 </div>
 
 

<!--<div id="map" style="height: 0px; width: 0px"></div> -->
<br>



<div id="skippy">
<!--we can just hide this w jquery - but we still need the code in the script -->

<form id="locForm">
<input name="" type="text" id="latlng" >
<input id="sendit" type="button" value="Reverse Geocode" onclick="codeLatLng()">
</form>

</div>

part 2 more<br><br>

Current Address (Accuracy: <strong><span id="nowaccuracy"></span></strong>):

<span class="fgreen">
<strong>
<div id = "address_current"></div>
</strong>


</span>

<!--ACTION: 
<strong>
<span class="fgreen" id="nowaction"></span></strong> -  -->


<br>





DATE: 
<strong>
<span id="nowgidts"></span></strong>


<!--<br>
<div id = "address_current2"></div> -->
</span>
<br>





part 33<br>


<!--need this<br> -->
<div id="tmp33">
<input id="logthisnow" type="button" class="ui-btn ui-btn-d tsize1" name="submit" value= " - LOG THIS LOCATION - " onClick="testResults(this.form)" />
</div>





<br>

<div align="center">


PART 444444444<br><br>


RECENT Geo LISTINGS FOR:<br>

<span class="print_data_22_b">


<strong>
<span class="cap1">
<span id="co_name"></span> </strong>(CID 
<span id="nowcid"></span> )
</span>
<br>

<span class="print_data_22_b">
<strong>
<!--<span id="nowwrkname"></span> -->

<span id="first"></span> <span id="last"></span>


</strong>

(WID <span id="nowwid"></span>)  

<!--<span id="Company"></span> -->

</span>
<br>



<!--
width="1200"
<div id="list" data-role="listview"></div> -->





<table  border="0" align="center" cellpadding="0" cellspacing="0" >

 

<!-- table header

width='200'
 -->

<thead>

<tr>
<th class='thinbox' align="center" valign="top">- RECORDS - </td>
<!--<th class='thinbox' align="left" valign="top">ID</td>
<th class='thinbox' align="left" valign="top">Action</td>
<th class='thinbox' align="left" valign="top">Latitude</td>
<th class='thinbox' align="left" valign="top">Longitude</td>
<th class='thinbox' align="left" valign="top">Accuracy</td>
<th class='thinbox'  align="left" valign="top">Time Stamp</td> -->

</tr>

</thead>

<tbody id="list" data-role="listview"></tbody>

</table>



</div>

<br><br>


<span class="print_data_22_b">

<span id="rtshow"></span>

</span>
<br><br>







































<script>
// PART 11111111111 get geo

// onSuccess Callback
// This method accepts a Position object, which contains the
// current GPS coordinates
//

$("#show1").hide(1000);

document.getElementById('progress').textContent = "Looking up Your Current Location... ";

var onSuccess = function(position) {

//alert('code: '    + 'yo'    + '\n');

// just local so goes away right after
// nah var sendready = "yes";
//alert(sendready);
  
document.getElementById('progress').textContent = "These are the results showing the current location... ";

// ok to send now
localStorage.setItem("sendready", 'yes');

// i guess var only good in block so move post here

// use LS

localStorage.setItem("Latitude", position.coords.latitude);
localStorage.setItem("Longitude", position.coords.longitude);
localStorage.setItem("Accuracy", position.coords.accuracy);
localStorage.setItem("Timestamp", position.timestamp);
localStorage.setItem("nowgeots", new Date(position.timestamp));
// clear action - do on next page
//localStorage.setItem("Action", "");




//new mv here


var gidts = new Date(Number(localStorage.getItem("Timestamp")));
document.getElementById('nowgidts').textContent = gidts;
document.getElementById('nowaccuracy').textContent = localStorage.getItem("Accuracy");
//document.getElementById('nowaction').textContent = localStorage.getItem("Action");









//go new here yo this works
// REAL YO window.location.replace("dr-show-location-save.html");

//window.location.replace("dr-main.html"); all-01

//window.location.replace("all-01.html");


//new after success trigger part 2

$("#sendit").trigger('click');






};

// onError Callback receives a PositionError object
//
function onError(error) {
    alert('code: '    + error.code    + '\n' +
          'message: ' + error.message + '\n');
}


// this is magic action do line
//navigator.geolocation.getCurrentPosition(onSuccess, onError);



// yo 88888888888888888888888888888888888888888888888888
function getgeo(){
	
//alert(event.target.name);
	
//clear - sometimes comes right back

document.getElementById('nowgidts').textContent = "";
document.getElementById('nowaccuracy').textContent = "";
document.getElementById('address_current').textContent = "";

	
	


// 3 actions work out
localStorage.setItem("Action", event.target.name);
document.getElementById("actionchoice").innerHTML = event.target.name;
// main 
navigator.geolocation.getCurrentPosition(onSuccess, onError);	
}


</script>














<script>


// PART 22 get Reverse geo


var geocoder;
var map;
var infowindow = new google.maps.InfoWindow();
var marker;

// initialize happens on load body - but maybe  later redo

function initialize()
{

//alert("go1");

var nowlat = localStorage.getItem("nowlat");
var nowlng = localStorage.getItem("nowlng");

    geocoder = new google.maps.Geocoder();
    map = new google.maps.Map(document.getElementById("map"),
    {
        zoom: 14,
        center: new google.maps.LatLng(nowlat,nowlng),
        mapTypeId: google.maps.MapTypeId.ROADMAP
		
		//me
		//document.getElementById('address_current').textContent = results[0].formatted_address;
		
    });
	
	
// me2
//alert("go1");
//document.getElementById('locForm').submit();

/// not here anymore????? $("#sendit").trigger('click');
	
}

function codeLatLng()
{
    var input = document.getElementById("latlng").value;
    var latlngStr = input.split(",",2);
    var lat = parseFloat(latlngStr[0]);
    var lng = parseFloat(latlngStr[1]);
    var latlng = new google.maps.LatLng(lat, lng);
    geocoder.geocode({'latLng': latlng}, function(results, status)
    {
        if (status == google.maps.GeocoderStatus.OK)
        {
            if (results[0])
            {
				
				//$('#address_current2').text(results[0].formatted_address);


// new save address		
				
localStorage.setItem("Address", results[0].formatted_address);
				
document.getElementById('address_current').textContent = results[0].formatted_address;

// yo try adding db save here

$("#logthisnow").trigger('click');



if (localStorage.getItem("sendready") == "yes"){

	$("#show1").show(1000);
	}

         
updatelist(); //call for list update

// end db save

				
                map.setZoom(11);
                marker = new google.maps.Marker(
                {
                    position: latlng,
                    map: map
                });
                infowindow.setContent(results[0].formatted_address);
                infowindow.open(map, marker);
            }
            else
            {
                alert("No results found");
            }
        }
        else
        {
            alert("Geocoder failed due to: " + status);
        }
    });
}


//pre populate

var a = document.getElementById("latlng");

// this for show page var latlngform = localStorage.getItem("nowlat") + "," + localStorage.getItem("nowlng")

var latlngform = localStorage.getItem("Latitude") + "," + localStorage.getItem("Longitude")
  a.value = latlngform;

//document.latlng.value=localStorage.getItem("nowlat");

document.getElementById('address_current').textContent = "Click to see..";

//$('#address_current').text('yo99');

</script>  























<!--INSERT END -->

</div><!-- end .box -->
</div><!-- end .content -->
</div><!-- /ui-content -->
  
</section><!-- /page -->

<footer data-role="footer" class="ui-barNAH" data-position="fixed" data-theme="a">
<div class="ui-grid-c boxblue">
<!--add footer -->

<!--foot -->

</div>
</footer>

<!-- /footer -->

</body>
</html>

<!-- code for including header/footer -->
    <script type="text/javascript">
      
      // we're ready, include away
      $(window).ready(function(){
        
        // use easy AJAX jQuery helpers
        
		// header no work!!!!
        // add header.html into <header>
        $.get("header-inc.html", function(fileData){
          $('header').html(fileData); 
        });
/* 
        // add footer.html into <footer>
        $.get("footer-inc.html", function(fileData){
          $('footer').html(fileData); 
        });
       
	   */
	   
	   
      });
      
    </script>
    
    
    
    
    
    
    
    

<script>

//$("#tmp33").show(4000);
//$("#tmp33").hide(4000);
	
//$("#skippy").show(4000);
$("#skippy").hide(0);

//$("#mappy").show(4000);
$("#mappy").hide(0);

</script>







<script>

// send to db part 3

function testResults (form) {

// start post	
	
// show that something is loading
		$('#responsepost').html("<b>Loading response...</b>");
		
		/*
		 * 'post_receiver.php' - where you will pass the form data
		 * $(this).serialize() - to easily read form data
		 * function(data){... - data contains the response from post_receiver.php
		 */


//here new 

var getstuff = localStorage.getItem("Latitude") + " - " + localStorage.getItem("Longitude") + " - " + localStorage.getItem("Accuracy") + " - " + localStorage.getItem("Timestamp") + " - " + localStorage.getItem("nowgeots") + " - " + localStorage.getItem("Action");

//alert("getstuff  " + getstuff);
	 
//$.post('https://idcapp.com/app-data/client-update-number.php', {
	
//$.post('../app-data/geo-add.php', {
	// no ssl here
$.post('http://nmiapp.com/zgeo/app-data/geo-add.php', {
//$.post('zgeox.html', {

address: 	localStorage.getItem("Address"),
latitude: 	localStorage.getItem("Latitude"),
longitude: 	localStorage.getItem("Longitude"),
accuracy: 	localStorage.getItem("Accuracy"),
timestamp: 	localStorage.getItem("Timestamp"),
nowgeots: 	localStorage.getItem("nowgeots"),
action: 	localStorage.getItem("Action"),	
cid:		localStorage.getItem("nowcid"),	
wid:		localStorage.getItem("nowwid")

// there was cid and wid - maybe dump
	
}, function(data){
			
			// show the response
			$('#responsepost').html(data);
			//
			//alert( "Posting yo." + getstuff);
// no need
			
			//$('#response2').html(data);
			
			//dr-geo-list-mobile.html
		//window.location.replace("geo-list-wrk-mobile.html");
		// BACK SOON OR JUST STAY HERE window.location.replace("dr-geo-list-mobile.html");
		}).fail(function() {
		
			// just in case posting your form failed
			alert( "Posting failed." );
			
		});

		// to prevent refreshing the whole page page
		return false;


//window.location.replace("new-client-application-register3.html");
		
			
	
}
</script>













<script>



function updatelist(){
	
	
	
	




// ALL PART 4 list results



//var Client_ID = localStorage.getItem("Client_ID");
	
	// var Client_ID = 25658;
	
	//var webpass = localStorage.getItem("cl_emp_Drivers_License_No");

//$.get("../app-data/geo-list.php?zip="+zip, function(data, status){			
//$.post('https://idcapp.com/app-data/random-tests.php', {
	
$.post('http://nmiapp.com/zgeo/app-data/geo-list-wrk.php', {	

wid: localStorage.getItem("nowwid")
	
//$.post('../app-data/geo-list.php', {	 	
		//Client_ID: Client_ID, 
		//webpass: webpass
		
		},
function(data, status){
	
// alert("Data: " + data + "\nStatus: " + status);
console.log ('data', data);
output = "";
 
// YO how do i add in the $completecheck I hid inside the loop 

//+ value.timestamp

/*
"Latitude: " + value.latitude + "<br>" +
"Longitude: " + value.longitude + "<br>" +
"<br>Date: <br><strong>" + value.newday + '--' +  showtime + '--' + nowts + "</strong><br>" +

*/

$.each(data, function(key, value) {
            	console. log ('item', key, value);

var nowts = new Date(Number(value.timestamp));	

var showtime =  ( nowts.toString("h:mm tt"));			
			
output += "<tr>" + 
				

"<td class='thinbox'><span class='thinbox9'>" + 


"Action: <span class='print_data_22 fgreen'><strong>" + value.action + "</strong></span><br>" +


"Date: <strong>" + value.newday + ' ' +  showtime + "</strong><br>" +
"<br>Address: <br><strong>" + value.address + "</strong><br>" +

"<br>Accuracy: " + value.accuracy + " (cid/wid: " + value.cid +"/"+ value.wid + ")<br>" +
"ID: <span class='print_data_18'>" +
value.gid + " <input type=button value=Show1 onClick='loc1(" + value.latitude + "," + value.longitude + "," + value.gid + "," + value.timestamp + "," + value.accuracy + ",\"" + value.action + "\")'>  <br>"+"</span><br>" +

"</span></td>" + 


 "</tr>";
 
 

 
 
 
 
 
			});
     
            $('#list').html( output );
            $('#list').listview( "refresh" );






	});
	


}// end updatelist function



</script>


<script>

function loc1(lat,lng,gid,ts,accuracy,action){
//alert(lat);
//alert(lng);
localStorage.setItem("nowlat", lat);
localStorage.setItem("nowlng", lng);
localStorage.setItem("nowgid", gid);
localStorage.setItem("nowgidts", ts);
localStorage.setItem("nowaccuracy", accuracy);
localStorage.setItem("nowaction", action);
localStorage.setItem("nowwrkname", localStorage.getItem("dr_first") + " " + localStorage.getItem("dr_last"));



//localStorage.setItem("nowlat", "34.1647988");
//localStorage.setItem("nowlng", "-118.40474929999998");
//alert("yo5");
window.location.replace("show-location.html");
}


</script>






<script>

document.getElementById('nowcid').textContent = localStorage.getItem("nowcid");
//document.getElementById('nowconame').textContent = localStorage.getItem("nowconame");
document.getElementById('nowwid').textContent = localStorage.getItem("nowwid");
//document.getElementById('nowwrkname').textContent = localStorage.getItem("nowwrkname");


document.getElementById('first').textContent = localStorage.getItem("dr_first");
document.getElementById('last').textContent = localStorage.getItem("dr_last");

document.getElementById('co_name').textContent = localStorage.getItem("co_name");


</script>
    
